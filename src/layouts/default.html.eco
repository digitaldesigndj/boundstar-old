<!doctype html>
<html lang="en">
  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="BoundStar, a StarBound Server!">
	<meta name="author" content="Taylor Young">

	<title>BoundStar</title>

	<link href="assets/css/font-awesome.min.css" rel="stylesheet">
	<link href="assets/css/main.css" rel="stylesheet">
	<link href="starbound-font/starbound-font.css" rel="stylesheet">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	<![endif]-->
</head>
<body>
	<div class="logo">
		<a href="/"><img src="/assets/img/logo.png" alt="" /></a>
	</div>

	<div class="content">
		<%- @content %>
	</div>

<div class="navigation">
	<a href="/">Home</a>
	<a href="/server.html">Commands</a>
</div>

	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script src="http://boundstar.com:8080/primus/primus.js"></script>
	<!--BACKSTRETCH-->
	<!-- You can use an image of whatever size. This script will stretch to fit in any screen size.-->
	<script type="text/javascript" src="assets/js/jquery.backstretch.min.js"></script>
	<script>
		$.backstretch("assets/img/bg.jpg", {speed: 1000});

/*
		$.getJSON('http://boundstar.com/players.json', function( data ) {
			$('.online').text( data.length + ' Players Online' )
			$players = $('.players');
			$.each( data , function( i, v ) {
				$players.append('<li>' + v + '</li>');
			});
		});
*/

		primus = new Primus('http://boundstar.com:8080/primus');

		primus.on('reconnect', function reconnect(opts) {
			console.log('reconnect', 'Reconnecting', 'We are <strong>scheduling</strong> a new reconnect attempt. This is attempt <strong>'+ opts.attempt +'</strong> and will trigger a reconnect operation in <strong>'+ opts.timeout +'</strong> ms.');
			$('.chat').text('reconnecting');
		});

		primus.on('reconnect', function reconnect() {
			console.log('reconnect', 'Reconnect', 'Starting the reconnect attempt, hopefully we get a connection!');
		});

		primus.on('online', function online() {
			console.log('network', 'Online', 'We have regained control over our internet connection.');
		});

		primus.on('offline', function offline() {
			console.log('network', 'Offline', 'We lost our internet connection.');
		});

		primus.on('open', function open() {
			console.log('open', 'Open', 'The connection has been established.');
			$('.chat').text('in-game universe chat:');
		});

		primus.on('error', function error(err) {
			console.log('error', 'Erorr', 'An unknown error has occured <code>'+ err.message +'</code>');
		});

		primus.on('data', function incoming(data) {
			console.log('data', 'Received data', 'string' === typeof data ? data : '<pre><code>'+ JSON.stringify(data, null, 2) +'</code></pre>');
			data = $.parseJSON( data );
			if( data.type === "chat" ) {
				$('.chat').append( '<p>' + data.message + '</p>' );
			}
			if( data.type === "player_list" ) {
				$('.online').text( data.list.length + ' Players Online' )
				$players = $('.players');
				$players.html('');
				$.each( data.list , function( i, v ) {
					$players.append('<li>' + v + '</li>');
				});
			}
		});

		primus.on('end', function end() {
			console.log('end', 'End', 'The connection has ended.');
			$('.chat').text('live chat disconnected');
		});

		primus.on('close', function end() {
			console.log('close', 'close', 'We\'ve lost the connection to the server.');
		});

		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-42766222-2', 'boundstar.com');
		ga('send', 'pageview');
	</script>
	<%- @getBlock('scripts').add(@scripts).toHTML() %>
</body>
</html>
